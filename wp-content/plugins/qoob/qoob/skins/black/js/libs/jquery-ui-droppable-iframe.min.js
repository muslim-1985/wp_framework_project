/*
 * jQuery ui dropppable Plugin
 * https://github.com/maxazan/jquery-ui-droppable-iframe
 *
 * Copyright 2015, Pomazan Maksym
 * Licensed under the MIT licenses.
 */
!function(a){var b=a.ui.ddmanager.prepareOffsets;a.ui.ddmanager.prepareOffsets=function(c,d){b.apply(this,arguments);var e=a.ui.ddmanager.droppables[c.options.scope]||[];for(i=0;i<e.length;i++)if((doc=e[i].document[0])!==document){var f=a((doc.defaultView||doc.parentWindow).frameElement),g=f.offset(),h=e[i].element,j={top:f.contents().scrollTop(),left:f.contents().scrollLeft()};j.right=j.left+f.width(),j.bottom=j.top+f.height();var k=h.offset();if(k.right=k.left+h.outerWidth(),k.bottom=k.top+h.outerHeight(),j.right<k.left||j.left>k.right||j.bottom<k.top||j.top>k.bottom){e[i].proportions().height=0;continue}var l=k.top-f.contents().scrollTop();l=l<0?0:l;var m=k.left-f.contents().scrollLeft();m=m<0?0:m;var n=k.top+h.height()-f.contents().scrollTop();n=n>f.height()?f.height():n;var o=k.left+h.width()-f.contents().scrollLeft();o=o>f.width()?f.width():o,e[i].offset.top=g.top+l,e[i].offset.left=g.left+m,e[i].proportions({width:o-m,height:n-l})}},a.ui.plugin.add("draggable","iframeScroll",{drag:function(b,c,d){var e=d.options,f=e.iframeFix===!0?"iframe":e.iframeFix;d.document.find(f).each(function(){var f,c=!1,g=a(this),h=g.offset();h.width=g.width(),h.height=g.height(),h.left<b.pageX&&b.pageX<h.left+h.width&&h.top<b.pageY&&b.pageY<h.top+e.scrollSensitivity&&(f=g.contents(),c=f.scrollTop(f.scrollTop()-e.scrollSpeed)),h.left<b.pageX&&b.pageX<h.left+h.width&&h.top+h.height-e.scrollSensitivity<b.pageY&&b.pageY<h.top+h.height&&(f=g.contents(),c=f.scrollTop(f.scrollTop()+e.scrollSpeed)),h.left<b.pageX&&b.pageX<h.left+e.scrollSensitivity&&h.top<b.pageY&&b.pageY<h.top+h.height&&(f=g.contents(),c=f.scrollLeft(f.scrollLeft()-e.scrollSpeed)),h.left+h.width-e.scrollSensitivity<b.pageX&&b.pageX<h.left+h.width&&h.top<b.pageY&&b.pageY<h.top+h.height&&(f=g.contents(),c=f.scrollLeft(f.scrollLeft()+e.scrollSpeed)),c!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b),clearTimeout(d.scrollTimer),d._mouseStarted&&(d.scrollTimer=setTimeout(function(){d._trigger("drag",b),a.ui.ddmanager&&a.ui.ddmanager.drag(d,b)},10))})},stop:function(a,b,c){clearInterval(c.scrollTimer)}})}(window.jQuery);