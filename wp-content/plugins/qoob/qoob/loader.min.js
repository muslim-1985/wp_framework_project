function Loader(){this.isStarted=!1,this.events={},this.queue={},this.loading={},this.loaded={},this.failed={}}Loader.prototype.isExists=function(a){return a in this.queue||a in this.loading||a in this.loaded},Loader.prototype.getCountQueue=function(){return Object.keys(this.queue).length},Loader.prototype.getCountLoading=function(){return Object.keys(this.loading).length},Loader.prototype.getCountLoaded=function(){return Object.keys(this.loaded).length},Loader.prototype.getCountFailed=function(){return Object.keys(this.failed).length},Loader.prototype.isDependencyLoaded=function(a){if(a)if(a.length){for(var b=0;b<a.length;b++)if(!(a[b]in this.loaded))return!1}else if(!(a in this.loaded))return!1;return!0},Loader.prototype.add=function(a,b){var c=this;if(a instanceof Array)for(var d=0;d<a.length;d++)this.add(a[d],b);else{var e=b||{};this.isExists(a.name)?a.onloaded&&(a.name in this.loaded?a.onloaded(this.loaded[a.name].data):this.on("loaded",function(b){b.name===a.name&&a.onloaded(c.loaded[a.name].data)})):(e.prefix&&(a.src=e.prefix+a.src),this.queue[a.name]=a,this.emmit("added",[a]),this.progress(),this.isStarted&&this.loadNext())}},Loader.prototype.removeListener=Loader.prototype.off=function(a,b){for(var c=0;c<this.events[a].length;c++)if(this.events[a][c].listener==b)return void this.events[a].splice(c,1)},Loader.prototype.on=function(a,b){this.events[a]=this.events[a]||[],this.events[a].push({listener:b,once:!1})},Loader.prototype.once=function(a,b){this.events[a]=this.events[a]||[],this.events[a].push({listener:b,once:!0})},Loader.prototype.emmit=Loader.prototype.trigger=function(a,b){if(this.events[a]&&this.events[a].length>0){for(var c=this.events[a],d=[],e=[],f=0;f<c.length;f++)e.push(c[f].listener),c[f].once||d.push(c[f]);for(this.events[a]=d,f=0;f<e.length;f++)e[f].apply(e[f],b)}},Loader.prototype.start=function(){this.isStarted=!0,this.emmit("start",[this.queue]),this.progress(),this.loadNext()},Loader.prototype.stop=function(){this.isStarted=!1,this.emmit("stop",[])},Loader.prototype.loadNext=function(){for(var a in this.queue)this.isDependencyLoaded(this.queue[a].dep)&&this.startLoading(a)},Loader.prototype._onLoaded=function(a){var b=this.loading[a];this.loaded[b.name]=b,delete this.loading[a],this.emmit("loaded",[b]),this.progress()},Loader.prototype._onLoadFail=function(a){var b=this.loading[a];this.failed[b.name]=b,delete this.loading[a],this.emmit("failed",[b]),this.progress()},Loader.prototype.progress=function(){this.emmit("progress",[this.getCountQueue(),this.getCountLoading(),this.getCountLoaded(),this.getCountFailed()]),this.getCountQueue()+this.getCountLoading()===0?this.emmit("complete",[this.loaded,this.failed]):this.isStarted&&this.loadNext()},Loader.prototype.startLoading=function(a){var b=this.queue[a];this.loading[a]=b,delete this.queue[a];var c=this;this.emmit("loading",[b]),"js"==b.type&&this.loadJS(b.src,function(){c._onLoaded(b.name)},function(){c._onLoadFail(b.name)}),"json"==b.type&&this.loadJSON(b.src,function(a){b.data=a,b.onloaded instanceof Function&&b.onloaded(a),c._onLoaded(b.name)},function(){c._onLoadFail(b.name)}),"css"==b.type&&this.loadCSS(b.src,function(){c._onLoaded(b.name)},function(){c._onLoadFail(b.name)}),"data"==b.type&&this.loadData(b.src,function(a){b.data=a,b.onloaded instanceof Function&&b.onloaded(a),c._onLoaded(b.name)},function(){c._onLoadFail(b.name)})},Loader.prototype.loadData=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){d.readyState===XMLHttpRequest.DONE&&(200===d.status?b&&b(d.responseText):c&&c(d))},d.open("GET",a,!0),d.send()},Loader.prototype.loadJSON=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){d.readyState===XMLHttpRequest.DONE&&(200===d.status?b&&b(JSON.parse(d.responseText)):c&&c(d))},d.open("GET",a,!0),d.send()},Loader.prototype.loadJS=function(a,b,c){var d=document.createElement("script");d.setAttribute("type","text/javascript"),d.setAttribute("src",a),d.onload=b,d.onerror=c,document.head.appendChild(d)},Loader.prototype.loadCSS=function(a,b,c){var d=document.createElement("link");d.setAttribute("rel","stylesheet"),d.setAttribute("href",a),d.onload=b,d.onerror=c,document.head.appendChild(d)},"undefined"!=typeof module&&(module.exports=Loader);